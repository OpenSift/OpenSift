<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>OpenSift</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin: 24px; max-width: 980px; }
      h1 { margin-bottom: 8px; }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
      .card { border: 1px solid #ddd; border-radius: 12px; padding: 14px; }
      .card h2 { font-size: 16px; margin: 0 0 10px; }
      label { display:block; font-size: 12px; margin-top: 10px; color: #333; }
      input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 10px; margin-top: 6px; }
      button { margin-top: 12px; padding: 10px 12px; border-radius: 10px; border: 1px solid #111; background: #111; color: #fff; cursor: pointer; }
      button.secondary { background: #fff; color: #111; border-color: #ddd; }
      .msg { background: #f5f5f5; border: 1px solid #eee; padding: 10px 12px; border-radius: 10px; margin: 12px 0; }
      .results { margin-top: 16px; }
      .result { border-top: 1px solid #eee; padding: 12px 0; }
      .meta { font-size: 12px; color: #666; margin-bottom: 6px; }
      pre { white-space: pre-wrap; word-break: break-word; background: #0b1020; color: #e9eefc; padding: 12px; border-radius: 12px; }
      @media (max-width: 900px){ .row { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <h1>OpenSift</h1>
    <p>Sift through URLs, PDFs, and notes. Ingest once. Search anytime.</p>
    <a href="/chat?owner=default">Open Chat</a>
    {% if request.query_params.get("msg") %}
      <div class="msg">{{ request.query_params.get("msg") }}</div>
    {% endif %}

    <div class="row">
      <div class="card">
        <h2>Ingest a URL</h2>
        <form method="post" action="/ingest/url">
          <label>Owner / Namespace</label>
          <input name="owner" value="default" />
          <label>Source Title (optional)</label>
          <input name="source_title" placeholder="e.g., Chapter 7 Notes" />
          <label>URL</label>
          <input name="url" placeholder="https://…" required />
          <button type="submit">Ingest URL</button>
        </form>
      </div>

      <div class="card">
        <h2>Upload a File</h2>
        <form method="post" action="/ingest/file" enctype="multipart/form-data">
          <label>Owner / Namespace</label>
          <input name="owner" value="default" />
          <label>File (.pdf, .txt, .md)</label>
          <input type="file" name="file" required />
          <button type="submit">Upload & Ingest</button>
        </form>
      </div>
    </div>

    <div class="card" style="margin-top:16px;">
      <h2>Search</h2>
      <form method="get" action="/search">
        <div class="row">
          <div>
            <label>Owner / Namespace</label>
            <input name="owner" value="default" />
          </div>
          <div>
            <label>Top K</label>
            <input name="k" type="number" value="5" min="1" max="20" />
          </div>
        </div>
        <label>Query</label>
        <input name="q" placeholder="Ask something about your ingested content…" />
        <button class="secondary" type="submit">Search</button>
      </form>

      <form method="post" action="/generate" style="margin-top: 12px;">
        <div class="row">
          <div>
            <label>Owner / Namespace</label>
            <input name="owner" value="default" />
          </div>
          <div>
            <label>Top K</label>
            <input name="k" type="number" value="8" min="1" max="20" />
          </div>
        </div>

        <label>Prompt</label>
        <input name="q" placeholder="e.g., Make me a quiz on these notes" required />

        <div class="row">
          <div>
            <label>Mode</label>
            <select name="mode">
              <option value="study_guide">Study Guide</option>
              <option value="key_points">Key Points</option>
              <option value="quiz">Quiz</option>
            </select>
          </div>
          <div>
            <label>Provider</label>
            <select name="provider">
              <option value="claude_code">Claude Code (setup-token)</option>
              <option value="claude">Claude (API key)</option>
              <option value="openai">OpenAI (API key)</option>
            </select>
          </div>
        </div>

        <label>Model (optional)</label>
        <input name="model" placeholder="Leave blank for default" />

        <button type="submit">Generate</button>
      </form>
    </div>

    {% if search_results %}
      <div class="results card">
        <h2>Results</h2>
        {% for r in search_results %}
          <div class="result">
            <div class="meta">
              <strong>{{ r.meta.source }}</strong>
              {% if r.meta.kind %} · {{ r.meta.kind }}{% endif %}
              {% if r.meta.url %} · <a href="{{ r.meta.url }}" target="_blank">link</a>{% endif %}
              · distance: {{ "%.4f"|format(r.distance) }}
            </div>
            <div>{{ r.text }}</div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% if generated %}
      <div class="results card">
        <h2>Generated</h2>
        <pre>{{ generated }}</pre>
      </div>
    {% endif %}
  </body>
</html>